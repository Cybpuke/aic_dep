HARD RESET: Docker-only, no system containerd usage

⚠️ This will delete all containers/images. That’s intentional.

1️⃣ Stop EVERYTHING
sudo systemctl stop docker docker.socket || true
sudo systemctl stop containerd || true
sudo systemctl stop rke2-agent rke2-server || true


Confirm nothing is running:

ps aux | egrep 'docker|containerd|rke2' | grep -v grep

2️⃣ REMOVE RKE2 COMPLETELY (mandatory)

RKE2 forces containerd. You cannot keep it.

sudo /usr/local/bin/rke2-uninstall.sh 2>/dev/null || true
sudo rm -rf /var/lib/rancher /etc/rancher


Verify:

ls /var/lib/rancher || echo "RKE2 gone"

3️⃣ REMOVE system containerd (this is safe now)
sudo systemctl disable --now containerd || true
sudo systemctl mask containerd
sudo yum remove -y containerd || true


Confirm:

which containerd || echo "containerd binary removed"
systemctl is-active containerd || true

4️⃣ WIPE ALL OLD STORAGE ON /

This is what is killing you.

sudo rm -rf /var/lib/containerd
sudo rm -rf /var/lib/docker
sudo rm -rf /etc/containerd


Check space:

df -h /


You should now have free space.

5️⃣ Configure Docker to use /mnt/data/docker ONLY
sudo mkdir -p /mnt/data/docker
sudo mkdir -p /etc/docker

cat <<'EOF' | sudo tee /etc/docker/daemon.json
{
  "data-root": "/mnt/data/docker"
}
EOF

6️⃣ Reinstall Docker cleanly (important)
sudo yum remove -y docker docker-ce docker-ce-cli docker-engine || true
sudo yum install -y docker-ce docker-ce-cli

7️⃣ Start Docker and VERIFY (this is the key check)
sudo systemctl daemon-reexec
sudo systemctl start docker
docker info | egrep -i 'Docker Root Dir|containerd'

✅ REQUIRED OUTPUT

You must see:

Docker Root Dir: /mnt/data/docker


And NO references to:

/var/lib/containerd
unix:///run/containerd/containerd.sock


If you still see them → stop here and paste the output.
